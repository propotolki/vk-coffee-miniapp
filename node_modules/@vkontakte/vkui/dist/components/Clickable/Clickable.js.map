{"version":3,"sources":["../../../src/components/Clickable/Clickable.tsx"],"sourcesContent":["'use client';\n\nimport * as React from 'react';\nimport { classNames, noop } from '@vkontakte/vkjs';\nimport { useFocusVisible } from '../../hooks/useFocusVisible';\nimport { type FocusVisibleModeProps } from '../../hooks/useFocusVisibleClassName';\nimport { useFocusVisibleClassName } from '../../hooks/useFocusVisibleClassName';\nimport { mergeCalls } from '../../lib/mergeCalls';\nimport { clickByKeyboardHandler } from '../../lib/utils';\nimport { RootComponent, type RootComponentProps } from '../RootComponent/RootComponent';\nimport { type StateProps } from './useState';\nimport { ClickableLockStateContext, DEFAULT_ACTIVE_EFFECT_DELAY, useState } from './useState';\nimport styles from './Clickable.module.css';\n\nfunction nonClickableProps<T>({\n  href,\n  onClick,\n  onClickCapture,\n  activeClassName,\n  hoverClassName,\n  hasActive,\n  hasHover,\n  hovered,\n  unlockParentHover,\n  activated,\n  activeEffectDelay,\n  focusVisibleMode,\n  DefaultComponent,\n  Component,\n  ...restProps\n}: ClickableProps<T>) {\n  return {\n    Component: Component || DefaultComponent,\n    ...restProps,\n    lockStateContextValue: {\n      lockHoverStateBubbling: undefined,\n      lockActiveStateBubbling: undefined,\n    },\n  };\n}\n\nfunction useClickableProps<T>({\n  baseClassName,\n  focusVisibleMode = 'inside',\n  activeClassName,\n  hoverClassName,\n  activeEffectDelay = DEFAULT_ACTIVE_EFFECT_DELAY,\n  hasHover = true,\n  hasActive = true,\n  hovered,\n  activated,\n  hasHoverWithChildren,\n  unlockParentHover,\n  onPointerEnter,\n  onPointerLeave,\n  onPointerDown,\n  onPointerCancel,\n  onPointerUp,\n  onBlur,\n  onFocus,\n  onKeyDown,\n  DefaultComponent,\n  ...restProps\n}: ClickableProps<T>) {\n  const { focusVisible, ...focusEvents } = useFocusVisible();\n  const focusVisibleClassNames = useFocusVisibleClassName({ focusVisible, mode: focusVisibleMode });\n\n  const {\n    stateClassName,\n    setLockHoverBubblingImmediate,\n    setLockActiveBubblingImmediate,\n    ...stateEvents\n  } = useState({\n    activeClassName,\n    hoverClassName,\n    activeEffectDelay,\n    hasHover,\n    hasActive,\n    hovered,\n    activated,\n    unlockParentHover,\n  });\n\n  const handlers = mergeCalls(\n    focusEvents,\n    stateEvents,\n    { onKeyDown: clickByKeyboardHandler },\n    {\n      onPointerEnter,\n      onPointerLeave,\n      onPointerDown,\n      onPointerCancel,\n      onPointerUp,\n      onBlur,\n      onFocus,\n      onKeyDown,\n    },\n  );\n\n  const lockStateContextValue = React.useMemo(\n    () => ({\n      lockHoverStateBubbling: hasHoverWithChildren ? noop : setLockHoverBubblingImmediate,\n      lockActiveStateBubbling: setLockActiveBubblingImmediate,\n    }),\n    [setLockHoverBubblingImmediate, setLockActiveBubblingImmediate, hasHoverWithChildren],\n  );\n\n  return {\n    baseClassName: classNames(\n      baseClassName,\n      styles.realClickable,\n      focusVisibleClassNames,\n      stateClassName,\n    ),\n    ...handlers,\n    ...restProps,\n    lockStateContextValue,\n  };\n}\n\nfunction useProps<T>(props: ClickableProps<T>): RootComponentProps<T> & {\n  lockStateContextValue: {\n    lockHoverStateBubbling: undefined | ((...args: any[]) => void);\n    lockActiveStateBubbling: undefined | ((...args: any[]) => void);\n  };\n} {\n  const commonProps = component(props);\n  const isClickable = checkClickable(props);\n\n  const {\n    baseClassName,\n    disabled, // Игнорируем disabled из пропсов, т.к. он обрабатывается в commonProps\n    Component,\n    ...restProps\n  } = props;\n\n  const nextProps = {\n    baseClassName: classNames(baseClassName, styles.host),\n    ...commonProps,\n    ...restProps,\n  };\n\n  const clickableProps = useClickableProps(nextProps);\n\n  return isClickable ? clickableProps : nonClickableProps(nextProps);\n}\n\nexport interface ClickableProps<T = HTMLElement>\n  extends RootComponentProps<T>,\n    FocusVisibleModeProps,\n    StateProps {\n  /**\n   * Компонент который будет при передаче `onClick`. По умолчанию `\"div\"`.\n   */\n  DefaultComponent?: React.ElementType;\n}\n\n/**\n * Проверяем, является ли компонент кликабельным.\n */\nexport function checkClickable<T>(props: ClickableProps<T>): boolean {\n  return (\n    (props.href !== undefined ||\n      props.onClick !== undefined ||\n      props.onClickCapture !== undefined ||\n      props.Component === 'a' ||\n      props.Component === 'button' ||\n      props.Component === 'label' ||\n      props.Component === 'input') &&\n    !props.disabled\n  );\n}\n\n/**\n * Определяет правильный компонент и его свойства.\n *\n * - если передан Component, используем его\n * - при передаче `href` превратится в `a`,\n * - при передаче `onClick` превратится в `div` c `role=\"button\"` и `tabIndex=\"0\"`.\n * - иначе используется `div`.\n */\nfunction component<T>({\n  Component,\n  DefaultComponent = 'div',\n  onClick,\n  onClickCapture,\n  href,\n  disabled,\n}: ClickableProps<T>): RootComponentProps<T> {\n  if (Component !== undefined) {\n    return { Component, disabled };\n  } else if (href !== undefined) {\n    return {\n      Component: 'a',\n\n      /**\n       * Если ссылка отключена, добавляем атрибуты для доступности.\n       *\n       * - Тег `a` не поддерживает атрибут disabled, поэтому используем `aria-disabled`\n       * - Тег `a` без `href` не является ссылкой, поэтому добавляем `role=\"link\"`.\n       *\n       * @see см. https://w3c.github.io/html-aria/#example-communicate-a-disabled-link-with-aria.\n       *\n       */\n      ...(disabled && {\n        'aria-disabled': true,\n        'role': 'link',\n      }),\n    };\n  } else if (onClick !== undefined || onClickCapture !== undefined) {\n    return {\n      Component: DefaultComponent,\n      role: 'button',\n      ...(disabled ? { 'aria-disabled': true } : { tabIndex: 0 }),\n    };\n  }\n\n  return {};\n}\n\n/**\n * Базовый кликабельный корневой компонент.\n *\n * - при передаче `href` превратится в `a`,\n * - при передаче `onClick` превратится в `div` c `role=\"button\"` и `tabIndex=\"0\"`.\n * - иначе используется `div`.\n *\n * Отвечает за:\n *\n * - стейты наведения и нажатия\n * - a11y компонентов.\n */\nexport const Clickable = <T,>(props: ClickableProps<T>): React.ReactNode => {\n  const { lockStateContextValue, children, ...restProps } = useProps(props);\n\n  return (\n    <RootComponent {...restProps}>\n      <ClickableLockStateContext.Provider value={lockStateContextValue}>\n        {children}\n      </ClickableLockStateContext.Provider>\n    </RootComponent>\n  );\n};\n"],"names":["React","classNames","noop","useFocusVisible","useFocusVisibleClassName","mergeCalls","clickByKeyboardHandler","RootComponent","ClickableLockStateContext","DEFAULT_ACTIVE_EFFECT_DELAY","useState","nonClickableProps","href","onClick","onClickCapture","activeClassName","hoverClassName","hasActive","hasHover","hovered","unlockParentHover","activated","activeEffectDelay","focusVisibleMode","DefaultComponent","Component","restProps","lockStateContextValue","lockHoverStateBubbling","undefined","lockActiveStateBubbling","useClickableProps","baseClassName","hasHoverWithChildren","onPointerEnter","onPointerLeave","onPointerDown","onPointerCancel","onPointerUp","onBlur","onFocus","onKeyDown","focusVisible","focusEvents","focusVisibleClassNames","mode","stateClassName","setLockHoverBubblingImmediate","setLockActiveBubblingImmediate","stateEvents","handlers","useMemo","useProps","props","commonProps","component","isClickable","checkClickable","disabled","nextProps","clickableProps","role","tabIndex","Clickable","children","Provider","value"],"mappings":"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"}