{"version":3,"sources":["../../../src/components/CustomSelect/CustomSelect.tsx"],"sourcesContent":["'use client';\n\nimport * as React from 'react';\nimport { classNames, debounce } from '@vkontakte/vkjs';\nimport { useAdaptivity } from '../../hooks/useAdaptivity';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useFocusWithin } from '../../hooks/useFocusWithin';\nimport { useStateWithPrev } from '../../hooks/useStateWithPrev';\nimport { callMultiple } from '../../lib/callMultiple';\nimport { useDOM } from '../../lib/dom';\nimport type { Alignment, Placement, Side } from '../../lib/floating';\nimport { defaultFilterFn, type FilterFn } from '../../lib/select';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { warnOnce } from '../../lib/warnOnce';\nimport {\n  CustomSelectDropdown,\n  type CustomSelectDropdownProps,\n} from '../CustomSelectDropdown/CustomSelectDropdown';\nimport {\n  CustomSelectOption,\n  type CustomSelectOptionProps,\n} from '../CustomSelectOption/CustomSelectOption';\nimport { DropdownIcon } from '../DropdownIcon/DropdownIcon';\nimport type { FormFieldProps } from '../FormField/FormField';\nimport type {\n  NativeSelectProps,\n  NativeSelectValue,\n  SelectValue,\n} from '../NativeSelect/NativeSelect';\nimport {\n  NOT_SELECTED,\n  remapFromNativeValueToSelectValue,\n  remapFromSelectValueToNativeValue,\n} from '../NativeSelect/NativeSelect';\nimport type { SelectType } from '../Select/Select';\nimport { Footnote } from '../Typography/Footnote/Footnote';\nimport { VisuallyHidden } from '../VisuallyHidden/VisuallyHidden';\nimport {\n  CustomSelectClearButton,\n  type CustomSelectClearButtonProps,\n} from './CustomSelectClearButton';\nimport {\n  CustomSelectInput,\n  type CustomSelectInputProps,\n} from './CustomSelectInput/CustomSelectInput';\nimport styles from './CustomSelect.module.css';\n\nconst sizeYClassNames = {\n  none: styles.sizeYNone,\n  compact: styles.sizeYCompact,\n};\n\nconst findIndexAfter = (options: CustomSelectOptionInterface[] = [], startIndex = -1) => {\n  if (startIndex >= options.length - 1) {\n    return -1;\n  }\n  return options.findIndex((option, i) => i > startIndex && !option.disabled);\n};\n\nconst findIndexBefore = (\n  options: CustomSelectOptionInterface[] = [],\n  endIndex: number = options.length,\n) => {\n  let result = -1;\n  if (endIndex <= 0) {\n    return result;\n  }\n  for (let i = endIndex - 1; i >= 0; i--) {\n    let option = options[i];\n\n    if (!option.disabled) {\n      result = i;\n      break;\n    }\n  }\n  return result;\n};\n\nconst warn = warnOnce('CustomSelect');\n\nconst checkOptionsValueType = <T extends CustomSelectOptionInterface>(options: T[]) => {\n  if (new Set(options.map((item) => typeof item.value)).size > 1) {\n    warn(\n      'Некоторые значения ваших опций имеют разные типы. onChange всегда возвращает строковый тип.',\n      'error',\n    );\n  }\n};\n\nconst checkMixControlledAndUncontrolledState = (\n  oldIsControlled: boolean,\n  newIsControlled: boolean,\n) => {\n  if (!oldIsControlled && newIsControlled) {\n    warn(\n      `Похоже, что компонент был переведен из состояния Uncontrolled в Controlled. Пожалуйста, не делайте так. Если вам нужно отобразить невыбранное состояние компонента, используйте value=null вместо undefined`,\n      'error',\n    );\n  }\n  if (oldIsControlled && !newIsControlled) {\n    warn(\n      `Похоже, что компонент был переведен из состояния Controlled в Uncontrolled. Пожалуйста, не делайте так. Если вам нужно отобразить невыбранное состояние компонента, используйте value=null вместо undefined`,\n      'error',\n    );\n  }\n};\n\nfunction defaultRenderOptionFn<T extends CustomSelectOptionInterface>({\n  option,\n  ...props\n}: CustomSelectRenderOption<T>): React.ReactNode {\n  return <CustomSelectOption {...props} />;\n}\n\nconst handleOptionDown: MouseEventHandler = (e: React.MouseEvent<HTMLElement>) => {\n  e.preventDefault();\n};\n\nfunction findSelectedIndex<T extends CustomSelectOptionInterface>(\n  options: T[] = [],\n  value: SelectValue,\n) {\n  if (value === NOT_SELECTED.CUSTOM) {\n    return -1;\n  }\n  return (\n    options.findIndex((item) => {\n      value = typeof item.value === 'number' ? Number(value) : value;\n      return item.value === value;\n    }) ?? -1\n  );\n}\n\nconst filter = <T extends CustomSelectOptionInterface>(\n  options: SelectProps<T>['options'],\n  inputValue: string,\n  filterFn: SelectProps<T>['filterFn'],\n) => {\n  return typeof filterFn === 'function'\n    ? options.filter((option) => filterFn(inputValue, option))\n    : options;\n};\n\n/* eslint-disable jsdoc/require-jsdoc */\ntype MousePosition = {\n  x: React.MouseEvent['clientX'];\n  y: React.MouseEvent['clientY'];\n};\n/* eslint-enable jsdoc/require-jsdoc */\n\nfunction isMousePositionChanged(event: React.MouseEvent, prevPosition: MousePosition) {\n  return (\n    Math.abs(prevPosition.x - event.clientX) >= 1 || Math.abs(prevPosition.y - event.clientY) >= 1\n  );\n}\n\nexport interface CustomSelectOptionInterface {\n  /**\n   * Значение.\n   */\n  value: Exclude<SelectValue, null>;\n  /**\n   * Отображаемый текст.\n   */\n  label: React.ReactElement | string;\n  /**\n   * Блокировка взаимодействия с компонентом.\n   */\n  disabled?: boolean;\n  [index: string]: any;\n}\n\nexport interface CustomSelectRenderOption<T extends CustomSelectOptionInterface>\n  extends CustomSelectOptionProps {\n  /**\n   * Данные об опции.\n   */\n  option: T;\n}\n\ntype PopupDirectionSide = Extract<Side, 'top' | 'bottom'>;\n\ntype PopupDirection = PopupDirectionSide | `${PopupDirectionSide}-${Alignment}`;\n\nexport type { CustomSelectClearButtonProps };\n\nexport interface SelectProps<\n  OptionInterfaceT extends CustomSelectOptionInterface = CustomSelectOptionInterface,\n> extends NativeSelectProps,\n    Omit<FormFieldProps, 'maxHeight'>,\n    Pick<CustomSelectDropdownProps, 'overscrollBehavior'>,\n    Pick<CustomSelectInputProps, 'minLength' | 'maxLength' | 'pattern' | 'readOnly'> {\n  /**\n   * Ref на внутрений компонент input.\n   */\n  getSelectInputRef?: React.Ref<HTMLInputElement>;\n  /**\n   * Если `true`, то при нажатии на `CustomSelect` в нём появится текстовое поле для поиска по `options`. По умолчанию поиск\n   * производится по `option.label`.\n   */\n  searchable?: boolean;\n  /**\n   * Текст, который будет отображен, если приходит пустой `options`.\n   */\n  emptyText?: string;\n  /**\n   * Событие изменения текстового поля.\n   */\n  onInputChange?: (e: React.ChangeEvent<HTMLInputElement>) => void;\n  /**\n   * Список опций в списке.\n   */\n  options: OptionInterfaceT[];\n  /**\n   * Функция для кастомной фильтрации. По умолчанию поиск производится по `option.label`.\n   */\n  filterFn?: false | FilterFn<OptionInterfaceT>;\n  /**\n   * Направление раскрытия выпадающего списка.\n   */\n  popupDirection?: PopupDirection;\n  /**\n   * Рендер-проп для кастомного рендера опции.\n   * В объекте аргумента приходят [свойства опции](https://vkui.io/components/custom-select#custom-select-option-api).\n   *\n   * > ⚠️  Важно: cвойство опции `disabled` должно выставляться только через проп `options`.\n   * > Запрещается выставлять `disabled` проп опциям в обход `options`, иначе `CustomSelect` не будет знать об актуальном состоянии\n   * опции.\n   */\n  renderOption?: (props: CustomSelectRenderOption<OptionInterfaceT>) => React.ReactNode;\n  /**\n   * Рендер-проп для кастомного рендера содержимого дропдауна.\n   * В `defaultDropdownContent` содержится список опций в виде скроллящегося блока.\n   */\n  renderDropdown?: ({\n    defaultDropdownContent,\n  }: {\n    defaultDropdownContent: React.ReactNode;\n  }) => React.ReactNode;\n  /**\n   * Если `true`, то в дропдауне вместо списка опций рисуется спиннер. При переданных `renderDropdown` и `fetching: true`\n   * \"победит\" `renderDropdown`.\n   */\n  fetching?: boolean;\n  /**\n   * Обработчик закрытия выпадающего списка.\n   */\n  onClose?: VoidFunction;\n  /**\n   * Обработчик открытия выпадающего списка.\n   */\n  onOpen?: VoidFunction;\n  /**\n   * Иконка раскрывающегося списка.\n   */\n  icon?: React.ReactNode;\n  /**\n   * Кастомная кнопка для очистки значения.\n   * Должна принимать обязательное свойство `onClick`.\n   */\n  ClearButton?: React.ComponentType<CustomSelectClearButtonProps>;\n  /**\n   * Если `true`, то справа будет отображаться кнопка для очистки значения.\n   */\n  allowClearButton?: boolean;\n  /**\n   * Передает атрибут `data-testid` для кнопки очистки.\n   */\n  clearButtonTestId?: string;\n  /**\n   * Отступ от выпадающего списка.\n   */\n  dropdownOffsetDistance?: number;\n  /**\n   * Ширина раскрывающегося списка зависит от контента.\n   */\n  dropdownAutoWidth?: boolean;\n  /**\n   * Использовать Portal для рендеринга выпадающего списка.\n   */\n  forceDropdownPortal?: boolean;\n  /**\n   * Тип отображения компонента.\n   */\n  selectType?: SelectType;\n  /**\n   * Отключает максимальную высоту по умолчанию.\n   */\n  noMaxHeight?: boolean;\n  /**\n   * Передает атрибут `data-testid` для элемента, внутри которого отображается текст выбранной опции `CustomSelect` или плейсхолдер.\n   */\n  labelTextTestId?: string;\n  /**\n   * Передает атрибут `data-testid` для нативного элемента `select`.\n   */\n  nativeSelectTestId?: string;\n  /**\n   * Обработчик события `keyDown` в поле ввода.\n   */\n  onInputKeyDown?: (e: React.KeyboardEvent, isOpen: boolean) => void;\n}\n\ntype MouseEventHandler = (event: React.MouseEvent<HTMLElement>) => void;\n\n/**\n * @see https://vkui.io/components/custom-select\n */\nexport function CustomSelect<OptionInterfaceT extends CustomSelectOptionInterface>(\n  props: SelectProps<OptionInterfaceT>,\n): React.ReactNode {\n  const [opened, setOpened] = React.useState(false);\n  const {\n    before,\n    name,\n    className,\n    getRef,\n    getRootRef,\n    popupDirection = 'bottom',\n    style,\n    onChange,\n    children,\n    'onInputChange': onInputChangeProp,\n    renderDropdown,\n    onOpen,\n    onClose,\n    fetching,\n    forceDropdownPortal,\n    selectType = 'default',\n    searchable = false,\n    'renderOption': renderOptionProp = defaultRenderOptionFn,\n    'options': optionsProp,\n    emptyText = 'Ничего не найдено',\n    filterFn = defaultFilterFn,\n    'icon': iconProp,\n    ClearButton = CustomSelectClearButton,\n    allowClearButton = false,\n    dropdownOffsetDistance = 0,\n    dropdownAutoWidth = false,\n    noMaxHeight = false,\n    'aria-labelledby': ariaLabelledBy,\n    clearButtonTestId,\n    nativeSelectTestId,\n    defaultValue,\n    required,\n    getSelectInputRef,\n    overscrollBehavior,\n    onInputKeyDown,\n    readOnly,\n    ...restProps\n  } = props;\n\n  if (process.env.NODE_ENV === 'development') {\n    checkOptionsValueType(optionsProp);\n  }\n\n  const { sizeY = 'none' } = useAdaptivity();\n\n  const containerRef = React.useRef<HTMLDivElement>(null);\n  const handleRootRef = useExternRef(containerRef, getRootRef);\n  const scrollBoxRef = React.useRef<HTMLDivElement | null>(null);\n  const selectElRef = useExternRef(getRef);\n  const optionsWrapperRef = React.useRef<HTMLDivElement>(null);\n  const scrollPerformedRef = React.useRef(false);\n\n  const [focusedOptionIndex, setFocusedOptionIndex] = React.useState<number | undefined>(-1);\n  const [isControlledOutside, setIsControlledOutside] = React.useState(props.value !== undefined);\n  const [inputValue, setInputValue] = React.useState('');\n  const [[nativeSelectValue, prevNativeSelectValue], setNativeSelectValue] =\n    useStateWithPrev<NativeSelectValue>(() => {\n      if (props.value !== undefined) {\n        return remapFromSelectValueToNativeValue(props.value);\n      }\n      if (defaultValue !== undefined) {\n        return remapFromSelectValueToNativeValue(defaultValue);\n      }\n      return NOT_SELECTED.NATIVE;\n    });\n\n  const [popperPlacement, setPopperPlacement] = React.useState<Placement>(popupDirection);\n\n  const options = React.useMemo(() => {\n    return filter(optionsProp, inputValue, filterFn);\n  }, [filterFn, inputValue, optionsProp]);\n\n  const [selectedOptionIndex, setSelectedOptionIndex] = React.useState<number | undefined>(\n    findSelectedIndex(options, props.value ?? defaultValue ?? null),\n  );\n\n  React.useEffect(\n    function updateOptionsIndexes() {\n      const value =\n        props.value !== undefined\n          ? props.value\n          : remapFromNativeValueToSelectValue(nativeSelectValue);\n\n      const selectedIndex = findSelectedIndex(options, value);\n      setSelectedOptionIndex(selectedIndex);\n      setFocusedOptionIndex(selectedIndex);\n    },\n    [props.value, nativeSelectValue, options, filterFn],\n  );\n\n  React.useEffect(\n    function syncIsControlledState() {\n      setIsControlledOutside((oldIsControlled) => {\n        const newIsControlled = props.value !== undefined;\n        checkMixControlledAndUncontrolledState(oldIsControlled, newIsControlled);\n        return newIsControlled;\n      });\n    },\n    [props.value],\n  );\n\n  React.useEffect(\n    function syncNativeSelectValueWithPropValue() {\n      if (props.value !== undefined) {\n        setNativeSelectValue(remapFromSelectValueToNativeValue(props.value));\n      }\n    },\n    [props.value, setNativeSelectValue],\n  );\n\n  useIsomorphicLayoutEffect(() => {\n    if (\n      options.some(({ value }) => nativeSelectValue === value) ||\n      (allowClearButton && nativeSelectValue === NOT_SELECTED.NATIVE)\n    ) {\n      const event = new Event('change', { bubbles: true });\n\n      selectElRef.current?.dispatchEvent(event);\n    }\n  }, [nativeSelectValue]);\n\n  const selected = React.useMemo(() => {\n    if (!options.length) {\n      return null;\n    }\n\n    return selectedOptionIndex !== undefined ? options[selectedOptionIndex] : undefined;\n  }, [options, selectedOptionIndex]);\n\n  const openedClassNames = React.useMemo(\n    () =>\n      (opened &&\n        dropdownOffsetDistance === 0 &&\n        (popperPlacement.includes('top') ? styles.popUp : styles.popDown)) ||\n      undefined,\n    [dropdownOffsetDistance, opened, popperPlacement],\n  );\n\n  const scrollToElement = React.useCallback((index: number, center = false) => {\n    const dropdown = scrollBoxRef.current;\n    const optionsWrapper = optionsWrapperRef.current;\n    const item =\n      dropdown && optionsWrapper ? (optionsWrapper.children[index] as HTMLElement) : null;\n\n    if (!item || !dropdown) {\n      return;\n    }\n\n    const dropdownHeight = dropdown.offsetHeight;\n    const scrollTop = dropdown.scrollTop;\n    const itemTop = item.offsetTop;\n    const itemHeight = item.offsetHeight;\n\n    if (center) {\n      dropdown.scrollTop = itemTop - dropdownHeight / 2 + itemHeight / 2;\n    } else if (itemTop + itemHeight > dropdownHeight + scrollTop) {\n      dropdown.scrollTop = itemTop - dropdownHeight + itemHeight;\n    } else if (itemTop < scrollTop) {\n      dropdown.scrollTop = itemTop;\n    }\n  }, []);\n\n  const focusOptionByIndex = React.useCallback(\n    (index: number | undefined, scrollTo = true) => {\n      if (index === undefined || index < 0 || index > (options.length ?? 0) - 1) {\n        return;\n      }\n\n      const option = options[index];\n\n      if (option?.disabled) {\n        return;\n      }\n\n      if (scrollTo) {\n        scrollToElement(index);\n      }\n\n      setFocusedOptionIndex(index);\n    },\n    [options, scrollToElement],\n  );\n\n  const isValidIndex = React.useCallback(\n    (index: number) => {\n      return index >= 0 && index < (options.length ?? 0);\n    },\n    [options.length],\n  );\n\n  useIsomorphicLayoutEffect(() => {\n    if (!opened) {\n      scrollPerformedRef.current = false;\n      return;\n    }\n\n    if (scrollPerformedRef.current) {\n      return;\n    }\n\n    const isIndexValid = selectedOptionIndex !== undefined && isValidIndex(selectedOptionIndex);\n\n    if (scrollBoxRef.current && isIndexValid) {\n      scrollPerformedRef.current = true;\n      scrollToElement(selectedOptionIndex, true);\n    }\n  }, [opened, selectedOptionIndex, scrollToElement, isValidIndex]);\n\n  const [keyboardInput, setKeyboardInput] = React.useState('');\n  const resetKeyboardInput = React.useCallback(() => {\n    setKeyboardInput('');\n  }, []);\n\n  const resetFocusedOption = React.useCallback(() => {\n    setFocusedOptionIndex(-1);\n  }, []);\n\n  const onKeyboardInput = React.useCallback(\n    (key: string) => {\n      if (!opened) {\n        setOpened(true);\n      }\n      resetFocusedOption();\n      const fullInput = keyboardInput + key;\n\n      setKeyboardInput(fullInput);\n    },\n    [keyboardInput, opened, resetFocusedOption],\n  );\n\n  const close = React.useCallback(() => {\n    resetKeyboardInput();\n\n    setInputValue('');\n    setOpened(false);\n    resetFocusedOption();\n    onClose?.();\n  }, [onClose, resetKeyboardInput, resetFocusedOption]);\n\n  const selectOption = React.useCallback(\n    (index: number) => {\n      const item = options[index];\n      setNativeSelectValue(item?.value ?? NOT_SELECTED.NATIVE);\n      close();\n\n      const shouldTriggerOnChangeWhenControlledAndInnerValueIsOutOfSync =\n        isControlledOutside &&\n        props.value !== nativeSelectValue &&\n        nativeSelectValue === item?.value;\n\n      if (shouldTriggerOnChangeWhenControlledAndInnerValueIsOutOfSync) {\n        const event = new Event('change', { bubbles: true });\n        selectElRef.current?.dispatchEvent(event);\n      }\n    },\n    [\n      close,\n      options,\n      selectElRef,\n      isControlledOutside,\n      props.value,\n      nativeSelectValue,\n      setNativeSelectValue,\n    ],\n  );\n\n  const selectFocused = React.useCallback(() => {\n    if (focusedOptionIndex === undefined || !isValidIndex(focusedOptionIndex)) {\n      return;\n    }\n\n    selectOption(focusedOptionIndex);\n  }, [focusedOptionIndex, isValidIndex, selectOption]);\n\n  const open = React.useCallback(() => {\n    setOpened(true);\n    setFocusedOptionIndex(selectedOptionIndex);\n\n    if (typeof onOpen === 'function') {\n      onOpen();\n    }\n  }, [onOpen, selectedOptionIndex]);\n\n  const onBlur = React.useCallback(() => {\n    close();\n    const event = new Event('focusout', { bubbles: true });\n    selectElRef.current?.dispatchEvent(event);\n  }, [close, selectElRef]);\n\n  const onFocus = React.useCallback(() => {\n    const event = new Event('focusin', { bubbles: true });\n    selectElRef.current?.dispatchEvent(event);\n  }, [selectElRef]);\n\n  const onClick = React.useCallback(() => {\n    if (opened) {\n      close();\n    } else {\n      open();\n    }\n  }, [close, open, opened]);\n\n  const handleKeyUp = React.useMemo(() => debounce(resetKeyboardInput, 1000), [resetKeyboardInput]);\n\n  const focusOption = React.useCallback(\n    (type: 'next' | 'prev') => {\n      let index = focusedOptionIndex;\n\n      if (type === 'next') {\n        const nextIndex = findIndexAfter(options, index);\n        index = nextIndex === -1 ? findIndexAfter(options) : nextIndex; // Следующий за index или первый валидный до index\n      } else if (type === 'prev') {\n        const beforeIndex = findIndexBefore(options, index);\n        index = beforeIndex === -1 ? findIndexBefore(options) : beforeIndex; // Предшествующий index или последний валидный после index\n      }\n\n      focusOptionByIndex(index);\n    },\n    [focusOptionByIndex, focusedOptionIndex, options],\n  );\n\n  const onNativeSelectChange: React.ChangeEventHandler<HTMLSelectElement> = (e) => {\n    // для ситуаций, когда в опциях value это string а value/defaultValue это number\n    // и наоборот, приводим значение nativeSelectValue из стейта к строке.\n    // ведь nativeSelect всегда возвращает string в onChange, а пользователь\n    // может использовать number для опций\n    //\n    // native select всегда возвращает string в качестве value в onChange\n    // Когда селект контролируемый, то пользователь, в onChange может сохранить в свой стейт строку (например '3'), хотя\n    // в качестве value опции может использовать число (3),\n    // тогда строчное значение value ('3') из стейта пользователя\n    // будет передано в CustomSelect, и после синхронизации nativeSelectValue (3) и props.value ('3') и после клика на уже выбранную опцию (3),\n    // когда nativeSelectValue обновится на значение опции (число 3),\n    // сравнение nativeSelectValue (3) и prevNativeSelectValue ('3') может не сработать лишь из-за того, что они в разных типах.\n    const convertedNativeSelectValue =\n      typeof nativeSelectValue === 'number' &&\n      (typeof props.value === 'string' || typeof prevNativeSelectValue === 'string')\n        ? String(nativeSelectValue)\n        : nativeSelectValue;\n\n    const isCalledWithSameControlledOptionValue =\n      isControlledOutside &&\n      props.value === remapFromNativeValueToSelectValue(convertedNativeSelectValue);\n\n    const isNativeValueChanged =\n      convertedNativeSelectValue !== prevNativeSelectValue && prevNativeSelectValue !== undefined;\n\n    const isTriggeredByClearButton = allowClearButton && nativeSelectValue === NOT_SELECTED.NATIVE;\n\n    const shouldCallOnChange =\n      !isCalledWithSameControlledOptionValue && (isNativeValueChanged || isTriggeredByClearButton);\n\n    if (!shouldCallOnChange) {\n      return;\n    }\n\n    const remappedNativeValue = remapFromNativeValueToSelectValue(e.currentTarget.value);\n\n    if (e.target.value === NOT_SELECTED.NATIVE) {\n      e.target.value = '';\n    }\n    if (e.currentTarget.value === NOT_SELECTED.NATIVE) {\n      e.currentTarget.value = '';\n    }\n\n    onChange?.(e, remappedNativeValue);\n  };\n\n  const onInputChange: React.ChangeEventHandler<HTMLInputElement> = React.useCallback(\n    (e) => {\n      onInputChangeProp && onInputChangeProp(e);\n      setInputValue(e.target.value);\n    },\n    [onInputChangeProp],\n  );\n\n  const areOptionsShown = React.useCallback(() => {\n    return scrollBoxRef.current !== null;\n  }, []);\n\n  const handleKeyDownSelect = React.useCallback(\n    (event: React.KeyboardEvent) => {\n      if (event.key.length === 1 && event.key !== ' ') {\n        onKeyboardInput(event.key);\n        return;\n      }\n\n      ['ArrowUp', 'ArrowDown', 'Escape', 'Enter'].includes(event.key) &&\n        areOptionsShown() &&\n        event.preventDefault();\n\n      switch (event.key) {\n        case 'ArrowUp':\n          if (opened) {\n            areOptionsShown() && focusOption('prev');\n          } else {\n            open();\n          }\n          break;\n        case 'ArrowDown':\n          if (opened) {\n            areOptionsShown() && focusOption('next');\n          } else {\n            open();\n          }\n          break;\n        case 'Escape':\n          close();\n          break;\n        case 'Backspace':\n        case 'Delete': {\n          if (!opened) {\n            setOpened(true);\n          }\n          resetFocusedOption();\n\n          break;\n        }\n        case 'Enter':\n        case 'Spacebar':\n        case ' ':\n          if (opened) {\n            areOptionsShown() && selectFocused();\n          } else {\n            open();\n          }\n          break;\n      }\n    },\n    [\n      areOptionsShown,\n      close,\n      focusOption,\n      onKeyboardInput,\n      open,\n      opened,\n      selectFocused,\n      resetFocusedOption,\n    ],\n  );\n\n  const handleInputKeydown = React.useCallback(\n    (event: React.KeyboardEvent) => {\n      onInputKeyDown?.(event, opened);\n    },\n    [opened, onInputKeyDown],\n  );\n  const _onInputKeyDown = callMultiple(handleKeyDownSelect, handleInputKeydown);\n\n  const handleOptionClick = React.useCallback(\n    (e: React.MouseEvent<HTMLElement>) => {\n      const index = Array.prototype.indexOf.call(\n        e.currentTarget.parentNode?.children,\n        e.currentTarget,\n      );\n      const option = options[index];\n\n      if (option && !option.disabled) {\n        selectOption(index);\n      }\n    },\n    [options, selectOption],\n  );\n\n  const lastMousePositionRef = React.useRef<MousePosition>({ x: 0, y: 0 });\n  const focusOptionOnMouseMove = React.useCallback(\n    (e: React.MouseEvent<HTMLElement>, index: number) => {\n      if (isMousePositionChanged(e, lastMousePositionRef.current)) {\n        focusOptionByIndex(index, false);\n      }\n    },\n    [focusOptionByIndex],\n  );\n\n  const popupAriaId = React.useId();\n  const renderOption = React.useCallback(\n    (option: OptionInterfaceT, index: number) => {\n      const hovered = index === focusedOptionIndex;\n      const selected = index === selectedOptionIndex;\n\n      return (\n        <React.Fragment key={`${typeof option.value}-${option.value}`}>\n          {renderOptionProp({\n            option,\n            hovered,\n            children: option.label,\n            selected,\n            disabled: option.disabled,\n            onClick: handleOptionClick,\n            onMouseDown: handleOptionDown,\n            // Используем `onMouseMove` вместо `onMouseEnter/onMouseOver`.\n            // Потому что если при навигации с клавиатуры курсор наведён на\n            // список, то при первом автоматическом скролле списка вызывается событие MouseOver/MouseEnter\n            // обработчик которого фокусирует опцию под курсором, хотя при навигация с клавиатуры пользователь мог уйти дальше по списку, это путает.\n            // Причём координаты события меняются на пару пикселей по сравнению с прошлым вызовом,\n            // а значит нельзя на них опираться, чтобы запретить обработку такого события.\n            // C mousemove такой проблемы нет, что позволяет реализовать поведение при наведении с клавиатуры и при наведении мышью идентично `<select>`.\n            onMouseMove: (e) => focusOptionOnMouseMove(e, index),\n            id: `${popupAriaId}-${option.value}`,\n            ...option,\n          })}\n        </React.Fragment>\n      );\n    },\n    [\n      focusedOptionIndex,\n      handleOptionClick,\n      focusOptionOnMouseMove,\n      renderOptionProp,\n      selectedOptionIndex,\n      popupAriaId,\n    ],\n  );\n\n  const resolvedContent = React.useMemo(() => {\n    const defaultDropdownContent =\n      options.length > 0 ? (\n        <div ref={optionsWrapperRef}>{options.map(renderOption)}</div>\n      ) : (\n        <Footnote className={styles.empty}>{emptyText}</Footnote>\n      );\n\n    if (typeof renderDropdown === 'function') {\n      return renderDropdown({ defaultDropdownContent });\n    } else {\n      return defaultDropdownContent;\n    }\n  }, [emptyText, options, renderDropdown, renderOption]);\n\n  const selectInputRef = useExternRef(getSelectInputRef);\n\n  const controlledValueSet = isControlledOutside && props.value !== NOT_SELECTED.CUSTOM;\n  const uncontrolledValueSet = !isControlledOutside && nativeSelectValue !== NOT_SELECTED.NATIVE;\n  const clearButtonShown =\n    allowClearButton && !opened && (controlledValueSet || uncontrolledValueSet);\n\n  const clearButton = React.useMemo(() => {\n    if (!clearButtonShown) {\n      return null;\n    }\n\n    return (\n      <ClearButton\n        className={iconProp === undefined ? styles.clearIcon : undefined}\n        onClick={function clearSelectState() {\n          setNativeSelectValue(NOT_SELECTED.NATIVE);\n          setInputValue('');\n          selectInputRef.current && selectInputRef.current.focus();\n        }}\n        disabled={restProps.disabled}\n        data-testid={clearButtonTestId}\n      />\n    );\n  }, [\n    clearButtonShown,\n    ClearButton,\n    iconProp,\n    restProps.disabled,\n    clearButtonTestId,\n    setNativeSelectValue,\n    selectInputRef,\n  ]);\n\n  const icon = React.useMemo(() => {\n    if (iconProp !== undefined) {\n      return iconProp;\n    }\n\n    return (\n      <DropdownIcon\n        className={clearButtonShown ? styles.dropdownIcon : undefined}\n        opened={opened}\n      />\n    );\n  }, [clearButtonShown, iconProp, opened]);\n\n  const afterIcons = !readOnly && (icon || clearButtonShown) && (\n    <React.Fragment>\n      {clearButton}\n      {icon}\n    </React.Fragment>\n  );\n\n  const { document } = useDOM();\n  const passClickAndFocusToInputOnClick = React.useCallback(\n    (e: React.MouseEvent<HTMLDivElement>) => {\n      // Раньше внешней оберткой CustomSelect был <label>, что позволяло по клику в любую область CustomSelect,\n      // даже где нету интерактивного элемента, фокусировать <input> и передавать на него событие клика.\n      // Так как мы больше не оборачиваем CustomSelect в <label>, то для обертки CustomSelect мы симулируем работу <label>.\n      // передаем фокус и клик по <input>, если пользователь кликнул в зоне обертки.\n      // В <label> мы не больше не оборачиваем, потому что это заставляет скринридер\n      // дважды произносить текст выбранной опции при фокусе, если CustomSelect связан с внешним <label>.\n      // Воспроизводится в некоторых версиях Chrome, при навигации по странице с помощью стрелок.\n      // Договорились со специалистом по доступности убрать <label>-обёртки из Select и CustomSelect\n\n      if (!selectInputRef.current || !document) {\n        return;\n      }\n\n      const clickTargetIsNotAnInput = e.target !== selectInputRef.current;\n      if (clickTargetIsNotAnInput) {\n        selectInputRef.current.click();\n\n        const inputIsNotFocused = document.activeElement !== selectInputRef.current;\n        if (inputIsNotFocused) {\n          selectInputRef.current.focus();\n        }\n      }\n    },\n    [document, selectInputRef],\n  );\n\n  const preventInputBlurWhenClickInsideFocusedSelectArea = (\n    e: React.MouseEvent<HTMLDivElement>,\n  ) => {\n    // Так как инпут больше не оборачивается пустым лэйблом, то клик внутри обертки,\n    // но вне инпута (например по иконке дропдауна), будет убирать фокус с инпута.\n    // Чтобы в такой ситуации отключить blur инпута мы превентим mousedown событие обёртки\n    const isInputFocused = document && document.activeElement === selectInputRef.current;\n    if (isInputFocused) {\n      e.preventDefault();\n    }\n  };\n\n  const ariaActiveDescendantOptionIndex: undefined | number =\n    focusedOptionIndex !== -1 ? focusedOptionIndex : undefined;\n  const ariaActiveDescendantId =\n    ariaActiveDescendantOptionIndex !== undefined\n      ? options[ariaActiveDescendantOptionIndex] && options[ariaActiveDescendantOptionIndex].value\n      : null;\n\n  const selectInputAriaProps: React.HTMLAttributes<HTMLElement> = {\n    'role': 'combobox',\n    'aria-controls': popupAriaId,\n    'aria-owns': popupAriaId,\n    'aria-expanded': opened,\n    'aria-activedescendant':\n      ariaActiveDescendantId && opened ? `${popupAriaId}-${ariaActiveDescendantId}` : undefined,\n    'aria-labelledby': ariaLabelledBy,\n    'aria-haspopup': 'listbox',\n    'aria-autocomplete': 'none',\n  };\n\n  const focusWithin = useFocusWithin(handleRootRef);\n\n  const resetOptionFocusOnMouseLeave = React.useCallback(\n    (event: React.MouseEvent) => {\n      // В Хроме eсли мышка пользователя находится над инпутом селекта,\n      // и он с клавиатуры открывает опции, причём одна из опций\n      // уже выбрана, то видно, как выбранная опция получает фокус,\n      // но потом сразу же его теряет.\n      // Связано это с тем, что в этот момент вызывается onMouseLeave, на который у нас\n      // завязан сброс состония фокуса у опции. По хорошему фокус должен оставаться.\n      // Нам не интересен вызов onMouseLeave если мышка при этом не двигалась.\n      if (isMousePositionChanged(event, lastMousePositionRef.current)) {\n        resetFocusedOption();\n      }\n    },\n    [resetFocusedOption],\n  );\n\n  return (\n    <div\n      className={classNames(styles.host, sizeY !== 'regular' && sizeYClassNames[sizeY], className)}\n      style={style}\n      ref={handleRootRef}\n      onClick={passClickAndFocusToInputOnClick}\n      onMouseDown={preventInputBlurWhenClickInsideFocusedSelectArea}\n      onMouseMove={function updateLastMousePosition(e) {\n        lastMousePositionRef.current = { x: e.clientX, y: e.clientY };\n      }}\n    >\n      {focusWithin && selected && !opened && (\n        <VisuallyHidden aria-live=\"polite\">{selected.label}</VisuallyHidden>\n      )}\n      <CustomSelectInput\n        autoComplete=\"off\"\n        autoCapitalize=\"none\"\n        autoCorrect=\"off\"\n        spellCheck=\"false\"\n        {...restProps}\n        {...selectInputAriaProps}\n        getRef={selectInputRef}\n        onFocus={onFocus}\n        onBlur={onBlur}\n        className={openedClassNames}\n        readOnly={readOnly || !searchable}\n        fetching={fetching}\n        value={inputValue}\n        onKeyUp={handleKeyUp}\n        onKeyDown={!readOnly ? _onInputKeyDown : undefined}\n        onChange={onInputChange}\n        onClick={!readOnly ? onClick : undefined}\n        before={before}\n        after={afterIcons}\n        selectType={selectType}\n      >\n        {selected?.label}\n      </CustomSelectInput>\n      <select\n        tabIndex={-1}\n        ref={selectElRef}\n        name={name}\n        onChange={onNativeSelectChange}\n        onBlur={props.onBlur}\n        onFocus={props.onFocus}\n        onClick={props.onClick}\n        value={nativeSelectValue}\n        aria-hidden\n        className={styles.control}\n        data-testid={nativeSelectTestId}\n        required={required}\n      >\n        {(allowClearButton || nativeSelectValue === NOT_SELECTED.NATIVE) && (\n          <option key={NOT_SELECTED.NATIVE} value={NOT_SELECTED.NATIVE} />\n        )}\n        {optionsProp.map((item) => (\n          <option key={`${item.value}`} value={item.value} />\n        ))}\n      </select>\n      {opened && (\n        <CustomSelectDropdown\n          targetRef={containerRef}\n          placement={popperPlacement}\n          scrollBoxRef={scrollBoxRef}\n          onPlacementChange={setPopperPlacement}\n          onMouseLeave={resetOptionFocusOnMouseLeave}\n          fetching={fetching}\n          overscrollBehavior={overscrollBehavior}\n          offsetDistance={dropdownOffsetDistance}\n          autoWidth={dropdownAutoWidth}\n          forcePortal={forceDropdownPortal}\n          noMaxHeight={noMaxHeight}\n          role=\"listbox\"\n          id={popupAriaId}\n          aria-labelledby={ariaLabelledBy}\n          tabIndex={-1}\n        >\n          {resolvedContent}\n        </CustomSelectDropdown>\n      )}\n    </div>\n  );\n}\n"],"names":["React","classNames","debounce","useAdaptivity","useExternRef","useFocusWithin","useStateWithPrev","callMultiple","useDOM","defaultFilterFn","useIsomorphicLayoutEffect","warnOnce","CustomSelectDropdown","CustomSelectOption","DropdownIcon","NOT_SELECTED","remapFromNativeValueToSelectValue","remapFromSelectValueToNativeValue","Footnote","VisuallyHidden","CustomSelectClearButton","CustomSelectInput","sizeYClassNames","none","compact","findIndexAfter","options","startIndex","length","findIndex","option","i","disabled","findIndexBefore","endIndex","result","warn","checkOptionsValueType","Set","map","item","value","size","checkMixControlledAndUncontrolledState","oldIsControlled","newIsControlled","defaultRenderOptionFn","props","handleOptionDown","e","preventDefault","findSelectedIndex","CUSTOM","Number","filter","inputValue","filterFn","isMousePositionChanged","event","prevPosition","Math","abs","x","clientX","y","clientY","CustomSelect","opened","setOpened","useState","before","name","className","getRef","getRootRef","popupDirection","style","onChange","children","onInputChangeProp","renderDropdown","onOpen","onClose","fetching","forceDropdownPortal","selectType","searchable","renderOptionProp","optionsProp","emptyText","iconProp","ClearButton","allowClearButton","dropdownOffsetDistance","dropdownAutoWidth","noMaxHeight","ariaLabelledBy","clearButtonTestId","nativeSelectTestId","defaultValue","required","getSelectInputRef","overscrollBehavior","onInputKeyDown","readOnly","restProps","process","env","NODE_ENV","sizeY","containerRef","useRef","handleRootRef","scrollBoxRef","selectElRef","optionsWrapperRef","scrollPerformedRef","focusedOptionIndex","setFocusedOptionIndex","isControlledOutside","setIsControlledOutside","undefined","setInputValue","nativeSelectValue","prevNativeSelectValue","setNativeSelectValue","NATIVE","popperPlacement","setPopperPlacement","useMemo","selectedOptionIndex","setSelectedOptionIndex","useEffect","updateOptionsIndexes","selectedIndex","syncIsControlledState","syncNativeSelectValueWithPropValue","some","Event","bubbles","current","dispatchEvent","selected","openedClassNames","includes","scrollToElement","useCallback","index","center","dropdown","optionsWrapper","dropdownHeight","offsetHeight","scrollTop","itemTop","offsetTop","itemHeight","focusOptionByIndex","scrollTo","isValidIndex","isIndexValid","keyboardInput","setKeyboardInput","resetKeyboardInput","resetFocusedOption","onKeyboardInput","key","fullInput","close","selectOption","shouldTriggerOnChangeWhenControlledAndInnerValueIsOutOfSync","selectFocused","open","onBlur","onFocus","onClick","handleKeyUp","focusOption","type","nextIndex","beforeIndex","onNativeSelectChange","convertedNativeSelectValue","String","isCalledWithSameControlledOptionValue","isNativeValueChanged","isTriggeredByClearButton","shouldCallOnChange","remappedNativeValue","currentTarget","target","onInputChange","areOptionsShown","handleKeyDownSelect","handleInputKeydown","_onInputKeyDown","handleOptionClick","Array","prototype","indexOf","call","parentNode","lastMousePositionRef","focusOptionOnMouseMove","popupAriaId","useId","renderOption","hovered","Fragment","label","onMouseDown","onMouseMove","id","resolvedContent","defaultDropdownContent","div","ref","selectInputRef","controlledValueSet","uncontrolledValueSet","clearButtonShown","clearButton","clearSelectState","focus","data-testid","icon","afterIcons","document","passClickAndFocusToInputOnClick","clickTargetIsNotAnInput","click","inputIsNotFocused","activeElement","preventInputBlurWhenClickInsideFocusedSelectArea","isInputFocused","ariaActiveDescendantOptionIndex","ariaActiveDescendantId","selectInputAriaProps","focusWithin","resetOptionFocusOnMouseLeave","updateLastMousePosition","aria-live","autoComplete","autoCapitalize","autoCorrect","spellCheck","onKeyUp","onKeyDown","after","select","tabIndex","aria-hidden","targetRef","placement","onPlacementChange","onMouseLeave","offsetDistance","autoWidth","forcePortal","role","aria-labelledby"],"mappings":"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"}